<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nepali for Tourists</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Add this line -->
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script> 

<!-- Your existing jQuery and Font Awesome includes -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Your main script block is below this -->
<script>
   $(document).ready(function() {
       // ... your existing code ...
   });
</script>
  <style>
    /* --- Root variables and basic body styles (unchanged) --- */
    :root {
      --primary-color: #dc143c;
      --secondary-color: #f9f3e5;
      --accent-color: #2d4059;
      --text-color: #333;
      --light-text: #777;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--text-color);
      background-color: #fff;
      margin: 0;
      padding: 0;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    /* --- Header, Tagline, WOTD (mostly unchanged) --- */
    header {
      text-align: center;
      padding: 30px 0;
      background-color: var(--secondary-color);
      border-radius: 12px;
      margin-bottom: 30px;
      position: relative;
    }
    
    h1 {
      color: var(--primary-color);
      margin-bottom: 10px;
    }
    
    .tagline {
      color: var(--light-text);
      font-size: 18px;
    }
    
    .wotd {
      background-color: var(--secondary-color);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      border-left: 5px solid var(--primary-color);
      position: relative; /* Added for bookmark button positioning */
    }
    
    .wotd h2 {
      color: var(--primary-color);
      margin-top: 0;
    }
    
    .wotd-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 15px;
    }
    
    .wotd-text {
      flex: 1;
    }
    
    .nepali-word {
      font-size: 28px;
      font-weight: bold;
      color: var(--accent-color);
      margin: 10px 0;
    }
    
    .english-word {
      font-size: 18px;
      margin-bottom: 10px;
    }
    
    .example {
      font-style: italic;
      color: var(--light-text);
    }

    .wotd-actions {
       display: flex;
       align-items: center;
       gap: 10px;
    }

    /* --- Tabs (unchanged) --- */
     .tabs {
      display: flex;
      margin-bottom: 20px;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      font-weight: 500;
    }
    
    .tab.active {
      border-bottom: 2px solid var(--primary-color);
      color: var(--primary-color);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }

    /* --- Grids (unchanged) --- */
     .word-grid, .sentence-grid, .bookmark-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }
    
    /* --- Translation Card - REVISED --- */
    .translation-card {
      background-color: #fff;
      border-radius: 10px;
      padding: 15px; /* Reduced padding */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative; /* Keep for bookmark button */
      display: flex; /* Use flexbox for layout */
      align-items: center; /* Vertically align items */
      gap: 15px; /* Space between image and text */
    }
    
    .translation-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }

    /* --- Card Image - REVISED --- */
    .card-image {
      width: 60px; /* Smaller fixed width */
      height: 60px; /* Smaller fixed height */
      background-color: #f0f0f0; /* Lighter placeholder */
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0; /* Prevent image from shrinking */
    }

    .card-image img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain; /* Use contain */
    }

    /* --- Card Content Wrapper - NEW --- */
    .card-content {
        flex: 1; /* Allow text content to take remaining space */
        position: relative; /* For positioning buttons inside if needed */
    }

    .english {
      color: var(--light-text);
      font-size: 14px;
      margin-bottom: 3px; /* Reduced margin */
    }
    
    .nepali {
      font-size: 20px; /* Slightly smaller */
      font-weight: bold;
      color: var(--accent-color);
      margin-bottom: 5px; /* Reduced margin */
    }

    .pronunciation { /* Added style for pronunciation if present */
        font-size: 14px;
        color: var(--light-text);
        font-style: italic;
        margin-bottom: 8px;
    }

    .card-actions { /* Wrapper for buttons */
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 5px;
    }
    
    .audio-button {
      background-color: transparent;
      color: var(--primary-color);
      border: none;
      cursor: pointer;
      transition: color 0.3s;
      font-size: 18px;
      padding: 0; /* Remove default padding */
      /* position: relative; Removed */
    }
    
    .audio-button:hover {
      color: #b01030;
    }
    
    /* --- Bookmark Button - REVISED POSITIONING --- */
    .bookmark-button {
      position: absolute;
      top: 10px; /* Adjusted */
      right: 10px; /* Adjusted */
      background-color: transparent;
      color: var(--light-text);
      border: none;
      cursor: pointer;
      font-size: 18px;
      transition: color 0.3s;
      padding: 5px; /* Add padding for easier clicking */
      line-height: 1;
      z-index: 2; /* Ensure it's above content */
    }

    /* Specific adjustment for WOTD bookmark */
    .wotd .bookmark-button {
        position: static; /* Override absolute positioning */
        margin-left: auto; /* Push to the right */
        top: auto;
        right: auto;
        font-size: 20px; /* Slightly larger */
    }
    
    .bookmark-button:hover, .bookmark-button.active {
      color: var(--primary-color);
    }

    /* --- Remove Bookmark Button (in modal) - NEW --- */
    .remove-bookmark-button, .remove-custom-word-button {
      background: none;
      border: none;
      color: var(--light-text);
      cursor: pointer;
      font-size: 16px;
      padding: 0;
      transition: color 0.3s ease;
    }
    .remove-bookmark-button:hover, .remove-custom-word-button:hover {
        color: var(--primary-color);
    }

    /* Tooltip (positioning adjusted slightly due to flex) */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltip-text {
      /* ... (tooltip styles mostly unchanged, check if position needs fine-tuning) */
      visibility: hidden;
      white-space: nowrap;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 5px;
      padding: 5px 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%; /* Position above the button */
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .tooltip .tooltip-text::after {
      content: "";
      position: absolute;
      top: 100%; /* Point down */
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
    }

    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    /* --- Show More, Footer, Hidden (unchanged) --- */
    .show-more {
      text-align: center;
      margin-top: 30px;
    }
    
    .show-more-btn {
      background-color: transparent;
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
      padding: 10px 20px;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
    }
    
    .show-more-btn:hover {
      background-color: var(--primary-color);
      color: white;
    }
    
    footer {
      text-align: center;
      margin-top: 50px;
      padding: 20px;
      color: var(--light-text);
      font-size: 14px;
    }
    
    .hidden {
      display: none;
    }
    
    /* --- Bookmarks Button, Modal, Tabs, Empty Messages (unchanged styles, maybe minor tweaks needed) --- */
    .bookmarks-button {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 8px 15px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    
    .bookmarks-button:hover {
      background-color: #b01030;
    }
    
    .bookmarks-count {
      background-color: white;
      color: var(--primary-color);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }
    
    .bookmarks-modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }
    
    .bookmarks-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 12px;
      max-width: 800px;
      width: 80%;
      position: relative;
    }
    
    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      font-weight: bold;
      color: var(--light-text);
      cursor: pointer;
      transition: color 0.3s;
    }
    
    .close-modal:hover {
      color: var(--primary-color);
    }
    
    .bookmarks-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .bookmarks-tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      font-weight: 500;
    }
    
    .bookmarks-tab.active {
      border-bottom: 2px solid var(--primary-color);
      color: var(--primary-color);
    }

    .bookmark-content { /* Added style for modal content */
        display: none;
    }
    .bookmark-content.active {
        display: block;
    }

    .empty-bookmark-message, .no-bookmarks { /* Consolidated styles */
      text-align: center;
      color: var(--light-text);
      padding: 30px;
    }

    /* --- Custom Word Form (unchanged) --- */
    .custom-word-form {
      background-color: var(--secondary-color);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .form-title {
      color: var(--primary-color);
      font-size: 20px;
      margin-top: 0;
      margin-bottom: 15px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-group {
      flex: 1;
      min-width: 200px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--accent-color);
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      box-sizing: border-box; /* Ensure padding doesn't increase size */
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .custom-word-submit {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s;
    }

    .custom-word-submit:hover {
      background-color: #b01030;
    }

    /* --- Autocomplete (unchanged) --- */
     .autocomplete-container {
      position: relative;
    }

    .autocomplete-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background-color: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 6px 6px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      display: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Added shadow */
    }

    .autocomplete-item {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #f5f5f5;
    }
     .autocomplete-item:last-child {
         border-bottom: none;
     }

    .autocomplete-item:hover {
      background-color: #f9f9f9;
    }

    /* --- Share Data Option (unchanged) --- */
    .share-data-option {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
      margin-bottom: 15px; /* Added margin */
    }

    .share-data-option input {
      margin: 0;
      width: auto; /* Override default input width */
      flex-shrink: 0;
    }
     .share-data-option label {
         font-size: 14px;
         color: var(--light-text);
     }

    /* --- Custom Word Tab Count (unchanged) --- */
    .bookmarks-tab[data-tab="custom-words"] {
      position: relative;
    }

    .custom-word-count {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>नेपाली सिकौँ (Learn Nepali)</h1>
      <div class="tagline">Essential Nepali phrases for your Himalayan adventure</div>
      <button class="bookmarks-button" id="show-bookmarks">
        <i class="fas fa-bookmark"></i>
        <span>My Saved words</span>
        <div class="bookmarks-count">0</div>
      </button>
    </header>
    
    <!-- Custom word/phrase form -->
    <div class="custom-word-form">
       <h3 class="form-title">Add Words or Phrases You've Learned</h3>
       <form id="custom-word-form-element"> <!-- Added form element -->
           <div class="form-row">
             <div class="form-group">
               <label for="custom-english">English</label>
               <div class="autocomplete-container">
                 <input type="text" id="custom-english" placeholder="Enter word or phrase in English" required>
                 <div class="autocomplete-results" id="english-autocomplete"></div>
               </div>
             </div>
             <div class="form-group">
               <label for="custom-nepali">Nepali (if you know it)</label>
               <input type="text" id="custom-nepali" placeholder="Enter word or phrase in Nepali (optional)">
             </div>
           </div>
           <div class="form-row">
             <div class="form-group">
               <label for="custom-pronunciation">Pronunciation (optional)</label>
               <input type="text" id="custom-pronunciation" placeholder="How to pronounce it">
             </div>
             <div class="form-group">
               <label for="custom-type">Type</label>
               <select id="custom-type">
                 <option value="word">Word</option>
                 <option value="sentence">Sentence</option>
               </select>
             </div>
           </div>
           <div class="share-data-option">
             <input type="checkbox" id="share-data" checked>
             <label for="share-data">Share with us to help improve our app (we'll add more words based on your needs)</label>
           </div>
           <button type="submit" class="custom-word-submit" id="add-custom-word">Add to My List</button>
       </form>
    </div>
    
    <!-- Word of the Day -->
    <div class="wotd">
      <h2>Word of the Day</h2>
      <div class="wotd-content">
        <div class="wotd-text">
          <div class="nepali-word">नमस्ते</div>
          <div class="english-word">Namaste - Hello/Greetings</div>
          <div class="example">Example: "नमस्ते, तपाईंलाई कस्तो छ?" (Namaste, tapāīṁlāī kasto cha?) - Hello, how are you?</div>
        </div>
        <div class="wotd-actions">
            <div class="tooltip">
              <button class="audio-button" data-text="नमस्ते" data-lang="ne-NP">
                <i class="fas fa-volume-up"></i>
              </button>
              <span class="tooltip-text">Listen</span>
            </div>
            <div class="tooltip">
              <button class="bookmark-button" data-type="word" data-english="Hello" data-nepali="नमस्ते" data-pronunciation="Namaste">
                <i class="far fa-bookmark"></i>
              </button>
              <span class="tooltip-text">Save</span>
            </div>
        </div>
      </div>
    </div>
    
    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" data-tab="words">Basic Words</div>
      <div class="tab" data-tab="sentences">Useful Sentences</div>
    </div>
    
    <!-- Words Tab -->
    <div class="tab-content active" id="words">
      <div class="word-grid">
        <!-- Example Card Structure (Repeat for all cards) -->
        <div class="translation-card">
          <div class="card-image">
            <!-- Placeholder: Color based on word in JS -->
            <img src="" alt="Hello concept"> <!-- Keep img tag, src set by JS or empty -->
          </div>
          <div class="card-content">
            <div class="english">Hello</div>
            <div class="nepali">नमस्ते</div>
            <div class="pronunciation">Namaste</div>
            <div class="card-actions">
                 <div class="tooltip">
                    <button class="audio-button" data-text="नमस्ते" data-lang="ne-NP">
                      <i class="fas fa-volume-up"></i>
                    </button>
                    <span class="tooltip-text">Listen</span>
                  </div>
            </div>
          </div>
          <div class="tooltip bookmark-tooltip"> <!-- Separate tooltip for bookmark for better positioning -->
            <button class="bookmark-button" data-type="word" data-english="Hello" data-nepali="नमस्ते" data-pronunciation="Namaste">
              <i class="far fa-bookmark"></i>
            </button>
            <span class="tooltip-text">Save</span>
          </div>
        </div>

        <div class="translation-card">
          <div class="card-image"><img src="" alt="Thank you concept"></div>
          <div class="card-content">
            <div class="english">Thank you</div>
            <div class="nepali">धन्यवाद</div>
            <div class="pronunciation">Dhanyavād</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="धन्यवाद" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Thank you" data-nepali="धन्यवाद" data-pronunciation="Dhanyavād"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

        <div class="translation-card">
          <div class="card-image"><img src="" alt="Yes concept"></div>
          <div class="card-content">
            <div class="english">Yes</div>
            <div class="nepali">हो</div>
            <div class="pronunciation">Ho</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="हो" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Yes" data-nepali="हो" data-pronunciation="Ho"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

        <div class="translation-card">
          <div class="card-image"><img src="" alt="No concept"></div>
          <div class="card-content">
            <div class="english">No</div>
            <div class="nepali">होइन</div>
            <div class="pronunciation">Hoina</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="होइन" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="No" data-nepali="होइन" data-pronunciation="Hoina"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

        <div class="translation-card">
          <div class="card-image"><img src="" alt="Water concept"></div>
          <div class="card-content">
            <div class="english">Water</div>
            <div class="nepali">पानी</div>
            <div class="pronunciation">Pani</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="पानी" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Water" data-nepali="पानी" data-pronunciation="Pani"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

        <div class="translation-card">
          <div class="card-image"><img src="" alt="Food concept"></div>
          <div class="card-content">
            <div class="english">Food</div>
            <div class="nepali">खाना</div>
            <div class="pronunciation">Khana</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="खाना" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Food" data-nepali="खाना" data-pronunciation="Khana"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

        </div><!-- end word-grid -->
      
      <!-- Hidden words (shown when "Show More" is clicked) -->
      <div class="word-grid hidden" id="more-words">
         <div class="translation-card">
          <div class="card-image"><img src="" alt="Good concept"></div>
          <div class="card-content">
            <div class="english">Good</div>
            <div class="nepali">राम्रो</div>
            <div class="pronunciation">Ramro</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="राम्रो" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Good" data-nepali="राम्रो" data-pronunciation="Ramro"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Friend concept"></div>
          <div class="card-content">
            <div class="english">Friend</div>
            <div class="nepali">साथी</div>
            <div class="pronunciation">Sathi</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="साथी" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Friend" data-nepali="साथी" data-pronunciation="Sathi"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Mountain concept"></div>
          <div class="card-content">
            <div class="english">Mountain</div>
            <div class="nepali">पहाड</div>
            <div class="pronunciation">Pahaad</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="पहाड" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Mountain" data-nepali="पहाड" data-pronunciation="Pahaad"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Beautiful concept"></div>
          <div class="card-content">
            <div class="english">Beautiful</div>
            <div class="nepali">सुन्दर</div>
            <div class="pronunciation">Sundar</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="सुन्दर" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Beautiful" data-nepali="सुन्दर" data-pronunciation="Sundar"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Money concept"></div>
          <div class="card-content">
            <div class="english">Money</div>
            <div class="nepali">पैसा</div>
            <div class="pronunciation">Paisa</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="पैसा" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Money" data-nepali="पैसा" data-pronunciation="Paisa"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Hotel concept"></div>
          <div class="card-content">
            <div class="english">Hotel</div>
            <div class="nepali">होटेल</div>
            <div class="pronunciation">Hotel</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="होटेल" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="word" data-english="Hotel" data-nepali="होटेल" data-pronunciation="Hotel"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>
      </div> <!-- end more-words grid -->
      
      <div class="show-more">
        <button class="show-more-btn" id="show-more-words">Show More Words</button>
      </div>
    </div> <!-- end words tab -->
    
    <!-- Sentences Tab -->
    <div class="tab-content" id="sentences">
      <div class="sentence-grid">
        <!-- Example Sentence Card Structure (Repeat for all) -->
         <div class="translation-card">
          <div class="card-image"><img src="" alt="Asking how someone is"></div>
          <div class="card-content">
            <div class="english">How are you?</div>
            <div class="nepali">तपाईंलाई कस्तो छ?</div>
            <div class="pronunciation">Tapāīṁlāī kasto cha?</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="तपाईंलाई कस्तो छ?" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="sentence" data-english="How are you?" data-nepali="तपाईंलाई कस्तो छ?" data-pronunciation="Tapāīṁlāī kasto cha?"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Introducing self"></div>
          <div class="card-content">
            <div class="english">My name is...</div>
            <div class="nepali">मेरो नाम ... हो</div>
            <div class="pronunciation">Mero naam ... ho</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="मेरो नाम हो" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="sentence" data-english="My name is..." data-nepali="मेरो नाम ... हो" data-pronunciation="Mero naam ... ho"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Asking price"></div>
          <div class="card-content">
            <div class="english">How much is this?</div>
            <div class="nepali">यो कति हो?</div>
            <div class="pronunciation">Yo kati ho?</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="यो कति हो?" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="sentence" data-english="How much is this?" data-nepali="यो कति हो?" data-pronunciation="Yo kati ho?"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Asking for bathroom"></div>
          <div class="card-content">
            <div class="english">Where is the bathroom?</div>
            <div class="nepali">शौचालय कहाँ छ?</div>
            <div class="pronunciation">Shauchalay kahã chha?</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="शौचालय कहाँ छ?" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="sentence" data-english="Where is the bathroom?" data-nepali="शौचालय कहाँ छ?" data-pronunciation="Shauchalay kahã chha?"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Ordering food"></div>
          <div class="card-content">
            <div class="english">I would like to order food</div>
            <div class="nepali">म खाना मगाउन चाहन्छु</div>
            <div class="pronunciation">Ma khana magaauna chahanchu</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="म खाना मगाउन चाहन्छु" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="sentence" data-english="I would like to order food" data-nepali="म खाना मगाउन चाहन्छु" data-pronunciation="Ma khana magaauna chahanchu"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>

         <div class="translation-card">
          <div class="card-image"><img src="" alt="Being lost"></div>
          <div class="card-content">
            <div class="english">I am lost</div>
            <div class="nepali">म हराएको छु</div>
            <div class="pronunciation">Ma haraeko chhu</div>
             <div class="card-actions">
                <div class="tooltip">
                    <button class="audio-button" data-text="म हराएको छु" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                    <span class="tooltip-text">Listen</span>
                </div>
             </div>
          </div>
           <div class="tooltip bookmark-tooltip">
                <button class="bookmark-button" data-type="sentence" data-english="I am lost" data-nepali="म हराएको छु" data-pronunciation="Ma haraeko chhu"><i class="far fa-bookmark"></i></button>
                <span class="tooltip-text">Save</span>
           </div>
        </div>
      </div> <!-- end sentence-grid -->
      
      <!-- Hidden sentences (shown when "Show More" is clicked) -->
      <div class="sentence-grid hidden" id="more-sentences">
          <div class="translation-card">
              <div class="card-image"><img src="" alt="Asking for menu"></div>
              <div class="card-content">
                <div class="english">Can I see the menu?</div>
                <div class="nepali">के म मेनु हेर्न सक्छु?</div>
                <div class="pronunciation">Ke ma menu herna sakchhu?</div>
                 <div class="card-actions">
                    <div class="tooltip">
                        <button class="audio-button" data-text="के म मेनु हेर्न सक्छु?" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                        <span class="tooltip-text">Listen</span>
                    </div>
                 </div>
              </div>
               <div class="tooltip bookmark-tooltip">
                    <button class="bookmark-button" data-type="sentence" data-english="Can I see the menu?" data-nepali="के म मेनु हेर्न सक्छु?" data-pronunciation="Ke ma menu herna sakchhu?"><i class="far fa-bookmark"></i></button>
                    <span class="tooltip-text">Save</span>
               </div>
           </div>
            <div class="translation-card">
              <div class="card-image"><img src="" alt="Asking to take photo"></div>
              <div class="card-content">
                <div class="english">Can I take a photo?</div>
                <div class="nepali">के म फोटो खिच्न सक्छु?</div>
                <div class="pronunciation">Ke ma photo khichna sakchhu?</div>
                 <div class="card-actions">
                    <div class="tooltip">
                        <button class="audio-button" data-text="के म फोटो खिच्न सक्छु?" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                        <span class="tooltip-text">Listen</span>
                    </div>
                 </div>
              </div>
               <div class="tooltip bookmark-tooltip">
                    <button class="bookmark-button" data-type="sentence" data-english="Can I take a photo?" data-nepali="के म फोटो खिच्न सक्छु?" data-pronunciation="Ke ma photo khichna sakchhu?"><i class="far fa-bookmark"></i></button>
                    <span class="tooltip-text">Save</span>
               </div>
           </div>
            <div class="translation-card">
              <div class="card-image"><img src="" alt="Asking for help"></div>
              <div class="card-content">
                <div class="english">Please help me</div>
                <div class="nepali">कृपया मलाई मद्दत गर्नुहोस्</div>
                <div class="pronunciation">Kripaya malai maddat garnuhos</div>
                 <div class="card-actions">
                    <div class="tooltip">
                        <button class="audio-button" data-text="कृपया मलाई मद्दत गर्नुहोस्" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                        <span class="tooltip-text">Listen</span>
                    </div>
                 </div>
              </div>
               <div class="tooltip bookmark-tooltip">
                    <button class="bookmark-button" data-type="sentence" data-english="Please help me" data-nepali="कृपया मलाई मद्दत गर्नुहोस्" data-pronunciation="Kripaya malai maddat garnuhos"><i class="far fa-bookmark"></i></button>
                    <span class="tooltip-text">Save</span>
               </div>
           </div>
            <div class="translation-card">
              <div class="card-image"><img src="" alt="Asking for time"></div>
              <div class="card-content">
                <div class="english">What time is it?</div>
                <div class="nepali">कति बज्यो?</div>
                <div class="pronunciation">Kati bajyo?</div>
                 <div class="card-actions">
                    <div class="tooltip">
                        <button class="audio-button" data-text="कति बज्यो?" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                        <span class="tooltip-text">Listen</span>
                    </div>
                 </div>
              </div>
               <div class="tooltip bookmark-tooltip">
                    <button class="bookmark-button" data-type="sentence" data-english="What time is it?" data-nepali="कति बज्यो?" data-pronunciation="Kati bajyo?"><i class="far fa-bookmark"></i></button>
                    <span class="tooltip-text">Save</span>
               </div>
           </div>
            <div class="translation-card">
              <div class="card-image"><img src="" alt="Understanding"></div>
              <div class="card-content">
                <div class="english">I understand</div>
                <div class="nepali">मैले बुझें</div>
                <div class="pronunciation">Maile bujhen</div>
                 <div class="card-actions">
                    <div class="tooltip">
                        <button class="audio-button" data-text="मैले बुझें" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                        <span class="tooltip-text">Listen</span>
                    </div>
                 </div>
              </div>
               <div class="tooltip bookmark-tooltip">
                    <button class="bookmark-button" data-type="sentence" data-english="I understand" data-nepali="मैले बुझें" data-pronunciation="Maile bujhen"><i class="far fa-bookmark"></i></button>
                    <span class="tooltip-text">Save</span>
               </div>
           </div>
            <div class="translation-card">
              <div class="card-image"><img src="" alt="Saying something is expensive"></div>
              <div class="card-content">
                <div class="english">Too expensive</div>
                <div class="nepali">धेरै महंगो</div>
                <div class="pronunciation">Dherai mahango</div>
                 <div class="card-actions">
                    <div class="tooltip">
                        <button class="audio-button" data-text="धेरै महंगो" data-lang="ne-NP"><i class="fas fa-volume-up"></i></button>
                        <span class="tooltip-text">Listen</span>
                    </div>
                 </div>
              </div>
               <div class="tooltip bookmark-tooltip">
                    <button class="bookmark-button" data-type="sentence" data-english="Too expensive" data-nepali="धेरै महंगो" data-pronunciation="Dherai mahango"><i class="far fa-bookmark"></i></button>
                    <span class="tooltip-text">Save</span>
               </div>
           </div>
      </div> <!-- end more-sentences grid -->
      
      <div class="show-more">
        <button class="show-more-btn" id="show-more-sentences">Show More Sentences</button>
      </div>
    </div> <!-- end sentences tab -->
    
    <!-- Bookmarks Modal -->
    <div id="bookmarks-modal" class="bookmarks-modal">
      <div class="bookmarks-content">
        <span class="close-modal">×</span>
        <h2>Your Saved Words & Phrases</h2>
        
        <div class="bookmarks-tabs">
          <div class="bookmarks-tab active" data-tab="saved-words">Saved Words</div>
          <div class="bookmarks-tab" data-tab="saved-sentences">Saved Sentences</div>
          <div class="bookmarks-tab" data-tab="custom-words">My Custom Words <span class="custom-word-count">0</span></div>
        </div>
        
        <!-- Content areas for modal tabs -->
        <div class="bookmark-content active" id="saved-words-content">
          <div class="bookmark-grid" id="bookmarked-words">
            <!-- Populated by JS -->
            <div class="no-bookmarks">You haven't saved any words yet. Click the bookmark icon on any word to save it here.</div>
          </div>
        </div>
        
        <div class="bookmark-content" id="saved-sentences-content">
          <div class="bookmark-grid" id="bookmarked-sentences">
             <!-- Populated by JS -->
            <div class="no-bookmarks">You haven't saved any sentences yet. Click the bookmark icon on any sentence to save it here.</div>
          </div>
        </div>
        
        <div class="bookmark-content" id="custom-words-content">
          <div class="bookmark-grid" id="custom-words-list">
             <!-- Populated by JS -->
             <div class="no-bookmarks">You haven't added any custom words yet. Use the form at the top of the page to add words you've learned.</div>
          </div>
        </div>
      </div>
    </div>
    
    <footer>
      <p>© 2025 Nepal Language Guide. Designed to help tourists learn essential Nepali phrases for their travels.</p>
    </footer>
  </div>
  
  <script>
     $(document).ready(function() {
    // --- START: Added Socket.IO Initialization ---
    // Connect to the Socket.IO server running on your backend
    // Replace 'http://localhost:3000' if your backend runs elsewhere
    const socket = io('http://localhost:3000'); 

    socket.on('connect', () => {
        console.log('Connected to backend via Socket.IO:', socket.id);
    });

    socket.on('disconnect', () => {
        console.log('Disconnected from backend.');
    });

    socket.on('connect_error', (err) => {
        console.error('Socket.IO connection error:', err);
        // Maybe display a message to the user that tracking isn't working
    });
    // --- END: Added Socket.IO Initialization ---


    const BOOKMARKS_KEY = 'nepali_bookmarks_v2'; 
    const CUSTOM_WORDS_KEY = 'nepali_custom_words_v2';
    const WOTD_DATE_KEY = 'nepali_wotd_date_v2';
    const WOTD_DATA_KEY = 'nepali_wotd_data_v2';
    const SESSION_ID_KEY = 'nepali_session_id_v2';

    // ... (Keep all your existing functions: tabs, show more, audio, form submission, etc.) ...
    
    // --- START: Modified trackUserAction ---
    // Function to track user actions 
    function trackUserAction(action, data) {
        // Log locally for debugging
        console.log('Tracking action:', action, data); 
        
        // Prepare data payload for the backend
        const eventPayload = {
            action: action,
            data: data,
            sessionId: getSessionId(), // Include session ID
            timestamp: new Date().toISOString() // Include timestamp
        };

        // Emit the event to the backend via Socket.IO
        if (socket && socket.connected) {
             // Only send if the action requires backend logging
             if (action === 'bookmark_action' || action === 'custom_word_added') {
                socket.emit('log_event', eventPayload);
                console.log('Event sent to backend:', eventPayload);
             }
             // Add other actions here if needed in the future
             // else if (action === 'audio_played') { ... } 

        } else {
            console.warn('Socket not connected, cannot send event to backend.');
            // Optional: Queue events locally if offline and send later? (More complex)
        }

        // Google Analytics or other client-side tracking can still go here
        // if (typeof gtag === 'function') { ... }
    }
    // --- END: Modified trackUserAction ---


    // --- START: Modify Bookmark Handling to call trackUserAction correctly ---
     $(document).on('click', '.bookmark-button', function(e) {
         e.preventDefault(); 
         const $button = $(this);
         const type = $button.data('type');
         const english = $button.data('english');
         const nepali = $button.data('nepali');
         const pronunciation = $button.data('pronunciation');
         const isActive = $button.hasClass('active');
         let bookmarkAction = ''; // 'added' or 'removed'

         if (isActive) {
             removeBookmark(type, english); // Update local storage
             $button.removeClass('active').html('<i class="far fa-bookmark"></i>');
             bookmarkAction = 'removed'; // Set action type for tracking
         } else {
             addBookmark(type, english, nepali, pronunciation); // Update local storage
             $button.addClass('active').html('<i class="fas fa-bookmark"></i>');
             bookmarkAction = 'added'; // Set action type for tracking
         }
         updateBookmarkCount(); // Update UI count

         // Call tracker function with specific bookmark action
         trackUserAction('bookmark_action', { 
             type: type, 
             english: english, 
             action: bookmarkAction // Pass 'added' or 'removed'
         });
     });
    // --- END: Modify Bookmark Handling ---


    // --- START: Modify Custom Word Form Submission ---
     $('#custom-word-form-element').submit(function(event) {
         event.preventDefault(); 

         const english = $('#custom-english').val().trim();
         const nepali = $('#custom-nepali').val().trim();
         const pronunciation = $('#custom-pronunciation').val().trim();
         const type = $('#custom-type').val();
         const shareData = $('#share-data').is(':checked'); // Check consent *here*

         if (english === '') {
           alert('Please enter an English word or phrase');
           return;
         }

         const added = addCustomWord(type, english, nepali, pronunciation); // Update local storage

         if (added) {
             $('#custom-word-form-element')[0].reset(); // Reset the form fields
             $('#english-autocomplete').hide(); 
             alert('"' + english + '" added to your custom list!');
             updateCustomWordCount(); // Update UI count
             if ($('#bookmarks-modal').is(':visible')) {
                 loadCustomWordsIntoModal();
             }

             // Track custom word ONLY IF user consented
             if (shareData) {
               trackUserAction('custom_word_added', {
                 type: type,
                 english: english,
                 nepali: nepali || '(not provided)',
                 pronunciation: pronunciation || '(not provided)'
               });
             } else {
                console.log('Custom word added locally, but not shared based on user consent.');
             }

         } else {
              alert('"' + english + '" is already in your custom list.');
         }
     });
    // --- END: Modify Custom Word Form Submission ---

    // ... (Keep ALL your other existing functions: getSessionId, getBookmarks, addBookmark, removeBookmark, updateBookmarkCount, loadBookmarksStateFromStorage, getCustomWords, addCustomWord, removeCustomWord, updateCustomWordCount, createCardHTML, loadBookmarksIntoModal, loadCustomWordsIntoModal, Modal Remove Handlers, checkIfEmptyModal, setupAutocomplete, setRandomWordOfTheDay, updateWordOfTheDayUI, loadCardImages) ...

     // Make sure getSessionId function exists
     function getSessionId() {
        let sessionId = localStorage.getItem(SESSION_ID_KEY);
        if (!sessionId) {
          sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          localStorage.setItem(SESSION_ID_KEY, sessionId);
        }
        return sessionId;
     }

    // Initialize things on page load
    loadBookmarksStateFromStorage();
    updateBookmarkCount();
    updateCustomWordCount();
    setupAutocomplete();
    setRandomWordOfTheDay();
    loadCardImages(); 

}); // End document ready
    $(document).ready(function() {
      const BOOKMARKS_KEY = 'nepali_bookmarks_v2'; // Use a new key if structure changed significantly
      const CUSTOM_WORDS_KEY = 'nepali_custom_words_v2';
      const WOTD_DATE_KEY = 'nepali_wotd_date_v2';
      const WOTD_DATA_KEY = 'nepali_wotd_data_v2';
      const SESSION_ID_KEY = 'nepali_session_id_v2';

      // --- Tab Functionality ---
      $('.tabs .tab').click(function() {
        const tab = $(this).data('tab');
        $('.tabs .tab').removeClass('active');
        $(this).addClass('active');
        $('.tab-content').removeClass('active');
        $('#' + tab).addClass('active');
      });
      
      // --- Show More Functionality ---
      $('#show-more-words').click(function() {
        const $moreWords = $('#more-words');
        $moreWords.toggleClass('hidden');
        $(this).text($moreWords.hasClass('hidden') ? 'Show More Words' : 'Show Less Words');
      });
      
      $('#show-more-sentences').click(function() {
        const $moreSentences = $('#more-sentences');
        $moreSentences.toggleClass('hidden');
        $(this).text($moreSentences.hasClass('hidden') ? 'Show More Sentences' : 'Show Less Sentences');
      });
      
      // --- Audio Functionality (Web Speech API) ---
      // Use event delegation for audio buttons added dynamically in the modal
      $(document).on('click', '.audio-button', function() {
        const text = $(this).data('text');
        const lang = $(this).data('lang') || 'ne-NP'; // Default to Nepali (Nepal)

        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel(); // Cancel any previous speech
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            
            // Optional: Find a specific voice if needed (more complex)
            // let voices = window.speechSynthesis.getVoices();
            // let nepaliVoice = voices.find(voice => voice.lang === lang);
            // if (nepaliVoice) {
            //     utterance.voice = nepaliVoice;
            // } else {
            //     console.warn(`Voice for ${lang} not found. Using default.`);
            // }
            
            utterance.onerror = function(event) {
                console.error('SpeechSynthesisUtterance.onerror', event);
                alert('Sorry, there was an error playing the audio.');
            };
            
            window.speechSynthesis.speak(utterance);
            
            // Track audio usage
            trackUserAction('audio_played', { text: text, language: lang });
        } else {
          alert('Sorry, your browser does not support text-to-speech.');
        }
      });
      
      // --- Bookmarks Functionality ---
      // Use event delegation for main page buttons too, for consistency
       $(document).on('click', '.bookmark-button', function(e) {
           e.preventDefault(); // Prevent potential form submission issues if button is inside a form
           const $button = $(this);
           const type = $button.data('type');
           const english = $button.data('english');
           const nepali = $button.data('nepali');
           const pronunciation = $button.data('pronunciation');
           const isActive = $button.hasClass('active');

           if (isActive) {
               removeBookmark(type, english);
               $button.removeClass('active').html('<i class="far fa-bookmark"></i>');
           } else {
               addBookmark(type, english, nepali, pronunciation);
               $button.addClass('active').html('<i class="fas fa-bookmark"></i>');
           }
           updateBookmarkCount();
       });

      // --- Bookmarks Modal ---
      $('#show-bookmarks').click(function() {
        loadBookmarksIntoModal(); // Load fresh data each time
        $('#bookmarks-modal').css('display', 'block');
      });
      
      $('.close-modal').click(function() {
        $('#bookmarks-modal').css('display', 'none');
      });
      
      // Close modal when clicking outside the content area
      $('#bookmarks-modal').click(function(event) {
        if ($(event.target).is('#bookmarks-modal')) {
          $(this).css('display', 'none');
        }
      });
      
      // Bookmarks tabs within modal
      $('.bookmarks-tabs .bookmarks-tab').click(function() {
        const tab = $(this).data('tab');
        $('.bookmarks-tabs .bookmarks-tab').removeClass('active');
        $(this).addClass('active');
        $('.bookmarks-modal .bookmark-content').removeClass('active');
        $('#' + tab + '-content').addClass('active');
      });
      
      // --- Custom Word Form Submission ---
       $('#custom-word-form-element').submit(function(event) {
           event.preventDefault(); // Prevent default form submission

           const english = $('#custom-english').val().trim();
           const nepali = $('#custom-nepali').val().trim();
           const pronunciation = $('#custom-pronunciation').val().trim();
           const type = $('#custom-type').val();
           const shareData = $('#share-data').is(':checked');

           if (english === '') {
             alert('Please enter an English word or phrase');
             return;
           }

           // Add to custom words list
           const added = addCustomWord(type, english, nepali, pronunciation);

           if (added) {
               // Clear form
               $('#custom-english').val('');
               $('#custom-nepali').val('');
               $('#custom-pronunciation').val('');
               $('#english-autocomplete').hide(); // Hide autocomplete results

               // Track custom word for analytics if user consented
               if (shareData) {
                 trackUserAction('custom_word_added', {
                   type: type,
                   english: english,
                   nepali: nepali || '(not provided)',
                   pronunciation: pronunciation || '(not provided)'
                 });
               }

               // Show success message
               alert('"' + english + '" added to your custom list!');

               // Update custom word count
               updateCustomWordCount();
                // If the modal is open, refresh the custom words tab
               if ($('#bookmarks-modal').is(':visible')) {
                   loadCustomWordsIntoModal();
               }
           } else {
                alert('"' + english + '" is already in your custom list.');
           }
       });
      
      // --- Initialization ---
      loadBookmarksStateFromStorage();
      updateBookmarkCount();
      updateCustomWordCount();
      setupAutocomplete();
      setRandomWordOfTheDay();
      loadCardImages(); // Load placeholder styles/colors

      // --- Storage Management Functions ---

      function getFromStorage(key) {
        const dataJson = localStorage.getItem(key);
        return dataJson ? JSON.parse(dataJson) : [];
      }

      function saveToStorage(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
      }

      // Bookmarks
      function getBookmarks() {
        return getFromStorage(BOOKMARKS_KEY);
      }

      function addBookmark(type, english, nepali, pronunciation) {
        let bookmarks = getBookmarks();
        const exists = bookmarks.some(bookmark => bookmark.type === type && bookmark.english === english);
        if (!exists) {
          bookmarks.push({ type, english, nepali, pronunciation });
          saveToStorage(BOOKMARKS_KEY, bookmarks);
          trackUserAction('bookmark_added', { type, english });
        }
      }
      
      function removeBookmark(type, english) {
        let bookmarks = getBookmarks();
        const initialLength = bookmarks.length;
        bookmarks = bookmarks.filter(bookmark => !(bookmark.type === type && bookmark.english === english));
        if (bookmarks.length < initialLength) {
            saveToStorage(BOOKMARKS_KEY, bookmarks);
            trackUserAction('bookmark_removed', { type, english });
        }
      }
      
      function updateBookmarkCount() {
        const count = getBookmarks().length;
        $('.bookmarks-count').text(count);
      }
      
      function loadBookmarksStateFromStorage() {
        const bookmarks = getBookmarks();
        // Reset all buttons first
        $('.bookmark-button').removeClass('active').html('<i class="far fa-bookmark"></i>');
        // Activate the saved ones
        bookmarks.forEach(bookmark => {
          $(`.bookmark-button[data-type="${bookmark.type}"][data-english="${bookmark.english}"]`)
            .addClass('active')
            .html('<i class="fas fa-bookmark"></i>');
        });
      }

      // Custom Words
      function getCustomWords() {
        return getFromStorage(CUSTOM_WORDS_KEY);
      }

      function addCustomWord(type, english, nepali, pronunciation) {
        let customWords = getCustomWords();
        const exists = customWords.some(word => word.english.toLowerCase() === english.toLowerCase());
        if (!exists) {
          customWords.push({
            type: type,
            english: english,
            nepali: nepali || '(not provided)',
            pronunciation: pronunciation || '(user will add later)'
          });
          saveToStorage(CUSTOM_WORDS_KEY, customWords);
          return true; // Indicate success
        }
        return false; // Indicate already exists
      }

      function removeCustomWord(english) {
        let customWords = getCustomWords();
        const initialLength = customWords.length;
        customWords = customWords.filter(word => word.english.toLowerCase() !== english.toLowerCase());
        if (customWords.length < initialLength) {
            saveToStorage(CUSTOM_WORDS_KEY, customWords);
            trackUserAction('custom_word_removed', { english });
        }
      }

      function updateCustomWordCount() {
        const count = getCustomWords().length;
        $('.custom-word-count').text(count);
      }


      // --- Modal Loading Functions ---

      function createCardHTML(item, isCustom = false) {
          // Note: Audio button might not be meaningful for custom words without Nepali text
          const audioButtonHTML = !isCustom || item.nepali !== '(not provided)' ? `
            <div class="tooltip">
              <button class="audio-button" data-text="${item.nepali}" data-lang="ne-NP">
                <i class="fas fa-volume-up"></i>
              </button>
              <span class="tooltip-text">Listen</span>
            </div>` : '';

           const removeButtonHTML = `
            <div class="tooltip">
              <button class="${isCustom ? 'remove-custom-word-button' : 'remove-bookmark-button'}" data-type="${item.type}" data-english="${item.english}">
                <i class="fas fa-times"></i>
              </button>
              <span class="tooltip-text">Remove</span>
            </div>`;

            return `
              <div class="translation-card">
                 <!-- No image in modal cards for simplicity -->
                 <div class="card-content" style="flex:1;"> <!-- Ensure content takes full width -->
                    <div class="english">${item.english}</div>
                    <div class="nepali">${item.nepali}</div>
                    <div class="pronunciation">${item.pronunciation}</div>
                    <div class="card-actions" style="justify-content: space-between;"> <!-- Space out buttons -->
                       ${audioButtonHTML}
                       ${removeButtonHTML}
                    </div>
                 </div>
              </div>
            `;
      }

      function loadBookmarksIntoModal() {
        const bookmarks = getBookmarks();
        const words = bookmarks.filter(b => b.type === 'word');
        const sentences = bookmarks.filter(b => b.type === 'sentence');

        const $wordsGrid = $('#bookmarked-words').empty();
        if (words.length === 0) {
          $wordsGrid.html('<div class="no-bookmarks">You haven\'t saved any words yet.</div>');
        } else {
          words.forEach(word => $wordsGrid.append(createCardHTML(word, false)));
        }

        const $sentencesGrid = $('#bookmarked-sentences').empty();
        if (sentences.length === 0) {
          $sentencesGrid.html('<div class="no-bookmarks">You haven\'t saved any sentences yet.</div>');
        } else {
          sentences.forEach(sentence => $sentencesGrid.append(createCardHTML(sentence, false)));
        }

         loadCustomWordsIntoModal(); // Load custom words too
      }

       function loadCustomWordsIntoModal() {
           const customWords = getCustomWords();
           const $customGrid = $('#custom-words-list').empty();
           if (customWords.length === 0) {
               $customGrid.html('<div class="no-bookmarks">You haven\'t added any custom words yet.</div>');
           } else {
               customWords.forEach(word => $customGrid.append(createCardHTML(word, true)));
           }
       }

       // --- Event Handlers for Removing items IN MODAL (using delegation) ---

       $('#bookmarked-words, #bookmarked-sentences').on('click', '.remove-bookmark-button', function() {
           const $button = $(this);
           const type = $button.data('type');
           const english = $button.data('english');

           removeBookmark(type, english);
           $button.closest('.translation-card').fadeOut(300, function() { $(this).remove(); checkIfEmptyModal(); });
           updateBookmarkCount();
           // Update the corresponding button on the main page
           $(`.bookmark-button[data-type="${type}"][data-english="${english}"]`)
               .removeClass('active')
               .html('<i class="far fa-bookmark"></i>');
       });

       $('#custom-words-list').on('click', '.remove-custom-word-button', function() {
           const $button = $(this);
           const english = $button.data('english');

           removeCustomWord(english);
            $button.closest('.translation-card').fadeOut(300, function() { $(this).remove(); checkIfEmptyModal(); });
           updateCustomWordCount();
       });

        function checkIfEmptyModal() {
            if ($('#bookmarked-words .translation-card').length === 0) {
                 $('#bookmarked-words').html('<div class="no-bookmarks">You haven\'t saved any words yet.</div>');
            }
            if ($('#bookmarked-sentences .translation-card').length === 0) {
                 $('#bookmarked-sentences').html('<div class="no-bookmarks">You haven\'t saved any sentences yet.</div>');
            }
             if ($('#custom-words-list .translation-card').length === 0) {
                 $('#custom-words-list').html('<div class="no-bookmarks">You haven\'t added any custom words yet.</div>');
            }
        }

      // --- Autocomplete Functionality ---
      function setupAutocomplete() {
        // Consolidate all predefined words/sentences for autocomplete source
        let autocompleteSource = [];
        $('.translation-card').each(function() {
            const $card = $(this);
            const english = $card.find('.english').text().trim();
            const nepali = $card.find('.nepali').text().trim();
            const pronunciation = $card.find('.pronunciation').text().trim();
            if (english && !autocompleteSource.some(item => item.english === english)) {
                autocompleteSource.push({ english, nepali, pronunciation });
            }
        });
        // Add WOTD if not already present
        const wotdEnglish = $('.wotd .english-word').text().split(' - ')[0].trim();
         if (wotdEnglish && !autocompleteSource.some(item => item.english === wotdEnglish)) {
              autocompleteSource.push({
                  english: wotdEnglish,
                  nepali: $('.wotd .nepali-word').text().trim(),
                  pronunciation: $('.wotd .english-word').text().split(' - ')[0].trim() // Use English as pronunciation placeholder
              });
         }


        $('#custom-english').on('input', function() {
          const input = $(this).val().toLowerCase();
          const $results = $('#english-autocomplete');
          $results.empty().hide(); // Clear previous results

          if (input.length < 1) return; // Show suggestions even for 1 character

          const matches = autocompleteSource.filter(item =>
            item.english.toLowerCase().includes(input)
          ).slice(0, 5); // Limit results

          if (matches.length > 0) {
            matches.forEach(match => {
              // Escape HTML for safety if displaying user-generated content in future
              const safeEnglish = $('<div>').text(match.english).html();
              $results.append(`
                <div class="autocomplete-item"
                     data-english="${$('<div>').text(match.english).html()}"
                     data-nepali="${$('<div>').text(match.nepali).html()}"
                     data-pronunciation="${$('<div>').text(match.pronunciation).html()}">
                  ${safeEnglish}
                </div>
              `);
            });
            $results.show();
          }
        });

        // Handle autocomplete item selection (using delegation)
        $('#english-autocomplete').on('click', '.autocomplete-item', function() {
          $('#custom-english').val($(this).data('english'));
          $('#custom-nepali').val($(this).data('nepali'));
          $('#custom-pronunciation').val($(this).data('pronunciation'));
          $('#english-autocomplete').hide();
        });

        // Hide autocomplete when clicking elsewhere
        $(document).on('click', function(e) {
          if (!$(e.target).closest('.autocomplete-container').length) {
            $('#english-autocomplete').hide();
          }
        });
      }
      
      // --- Tracking Functionality ---
      function trackUserAction(action, data) {
        console.log('Tracking action:', action, data); // Log for demo
        // Add real tracking code here if needed (e.g., Google Analytics, custom backend)
        /*
        fetch('/api/track', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                action: action,
                data: data,
                sessionId: getSessionId(),
                timestamp: new Date().toISOString()
            })
        }).catch(error => console.error('Tracking error:', error));
        */
      }
      
      function getSessionId() {
        let sessionId = localStorage.getItem(SESSION_ID_KEY);
        if (!sessionId) {
          sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          localStorage.setItem(SESSION_ID_KEY, sessionId);
        }
        return sessionId;
      }
      
      // --- Word of the Day Logic ---
      function setRandomWordOfTheDay() {
        const today = new Date().toDateString();
        const lastWordDate = localStorage.getItem(WOTD_DATE_KEY);
        
        let wordData;
        if (today === lastWordDate) {
          const savedWordJson = localStorage.getItem(WOTD_DATA_KEY);
          if (savedWordJson) {
              wordData = JSON.parse(savedWordJson);
          }
        }
        
        if (!wordData) { // Pick a new word if no saved data or date mismatch
            const allWords = [
              {nepali: "नमस्ते", english: "Namaste", description: "Hello/Greetings", example: "नमस्ते, तपाईंलाई कस्तो छ?", example_en: "Hello, how are you?"},
              {nepali: "धन्यवाद", english: "Dhanyavād", description: "Thank you", example: "धन्यवाद, तपाईंको मद्दतको लागि।", example_en: "Thank you for your help."},
              {nepali: "माफ गर्नुहोस्", english: "Māph garnuhos", description: "Sorry/Excuse me", example: "माफ गर्नुहोस्, शौचालय कहाँ छ?", example_en: "Excuse me, where is the bathroom?"},
              {nepali: "राम्रो", english: "Ramro", description: "Good", example: "यो खाना धेरै राम्रो छ।", example_en: "This food is very good."},
              {nepali: "स्वागत छ", english: "Swāgat cha", description: "Welcome", example: "नेपालमा तपाईंलाई स्वागत छ।", example_en: "Welcome to Nepal."},
              {nepali: "कति?", english: "Kati?", description: "How much/many?", example: "यो कति हो?", example_en: "How much is this?" },
              {nepali: "पानी", english: "Pani", description: "Water", example: "एक बोतल पानी, कृपया।", example_en: "One bottle of water, please."}
            ];
            wordData = allWords[Math.floor(Math.random() * allWords.length)];
            localStorage.setItem(WOTD_DATE_KEY, today);
            localStorage.setItem(WOTD_DATA_KEY, JSON.stringify(wordData));
        }

        updateWordOfTheDayUI(wordData);
      }
      
      function updateWordOfTheDayUI(wordData) {
        $('.wotd .nepali-word').text(wordData.nepali);
        $('.wotd .english-word').text(`${wordData.english} - ${wordData.description}`);
        $('.wotd .example').text(`Example: "${wordData.example}" (${wordData.example_en})`);
        
        // Update buttons' data attributes
        const $wotdAudio = $('.wotd .audio-button');
        $wotdAudio.data('text', wordData.nepali);
        $wotdAudio.attr('data-text', wordData.nepali); // Also update attribute for potential CSS selectors

        const $wotdBookmark = $('.wotd .bookmark-button');
        $wotdBookmark.data('english', wordData.english); // Use base English word for key
        $wotdBookmark.data('nepali', wordData.nepali);
        $wotdBookmark.data('pronunciation', wordData.english); // Use base English as placeholder
        // Also update attributes
        $wotdBookmark.attr('data-english', wordData.english);
        $wotdBookmark.attr('data-nepali', wordData.nepali);
        $wotdBookmark.attr('data-pronunciation', wordData.english);

        // Check if this WOTD is already bookmarked
        const bookmarks = getBookmarks();
        const isBookmarked = bookmarks.some(b => b.type === 'word' && b.english === wordData.english);
        if (isBookmarked) {
            $wotdBookmark.addClass('active').html('<i class="fas fa-bookmark"></i>');
        } else {
            $wotdBookmark.removeClass('active').html('<i class="far fa-bookmark"></i>');
        }
      }
      
      // --- Placeholder Image Loading ---
      function loadCardImages() {
        const colors = ['#FFD6A5', '#FDFFB6', '#CAFFBF', '#9BF6FF', '#A0C4FF', '#BDB2FF', '#FFC6FF', '#FBC6A4', '#F4A896'];
        $('.translation-card .card-image').each(function(index) {
           // Use index or hash of text for color variation
           const bgColor = colors[index % colors.length];
           $(this).css('background-color', bgColor);
           // In a real app, you'd set the img src here, e.g.:
           // const englishWord = $(this).closest('.translation-card').find('.english').text().toLowerCase().replace(/\s+/g, '-');
           // $(this).find('img').attr('src', `/images/${englishWord}.jpg`).attr('alt', `Image for ${englishWord}`);
        });
      }

    }); // End document ready
  </script>
</body>
</html>
