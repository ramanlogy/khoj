<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Featured Events Carousel</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- Base Styles --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.5;
        }

        /* --- Featured Events Section Styles --- */
        #featured-events {
            padding: 40px 0;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            overflow: hidden;
            position: relative;
        }

        #featured-events .container {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        #featured-events h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #4a148c; /* Deep purple */
            font-size: 2rem;
            font-weight: 600;
            position: relative;
        }

        #featured-events h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 4px;
            background-color: #7b1fa2; /* Accent purple */
            border-radius: 2px;
        }

        /* --- Carousel Container & Track --- */
        .featured-carousel {
            position: relative;
            width: 100%;
            overflow: hidden;
            padding: 20px 0;
        }

        .carousel-track {
            display: flex;
            transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            will-change: transform;
            padding-bottom: 10px; /* Space for card shadow */
        }

        /* --- Event Card Styles --- */
        .featured-event-card {
            flex: 0 0 260px;
            margin: 0 10px;
            height: 175px; /* Slightly increased height for share button */
            border-radius: 12px;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            overflow: hidden; /* Changed from visible for clean corners */
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .featured-event-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .event-card-header {
            height: 8px;
            width: 100%;
            flex-shrink: 0;
        }

        .event-card-content {
            padding: 15px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            position: relative; /* Needed for absolute positioning of share menu */
            overflow: hidden; /* Hide potential text overflow */
        }

        .event-meta-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .event-date-badge {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(3px);
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.7rem;
            font-weight: 600;
            color: #555;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .event-date-badge i {
            margin-right: 4px;
            color: #7b1fa2;
            font-size: 0.75rem;
        }

        .event-category-tag {
            font-size: 0.7rem;
            font-weight: 500;
            color: #666;
            background-color: #f0f0f0;
            padding: 3px 6px;
            border-radius: 4px;
            text-transform: capitalize;
        }

        .featured-event-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 2.6em;
            flex-grow: 1; /* Allow title to expand */
        }

        .featured-event-detail {
            font-size: 0.75rem;
            color: #555;
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }
        .featured-event-detail:last-child {
             margin-bottom: 0; /* Remove margin below last detail item */
        }

        .featured-event-detail i {
            margin-right: 5px;
            font-size: 0.8rem;
            width: 14px;
            text-align: center;
            color: #888;
        }

        /* --- Urgency Badge --- */
        .urgency-badge {
            position: absolute;
            top: 12px; left: -5px;
            background-color: #ff4081; color: white;
            padding: 3px 8px 3px 10px; font-size: 0.65rem; font-weight: bold;
            border-radius: 0 4px 4px 0; box-shadow: 1px 1px 5px rgba(0,0,0,0.2);
            z-index: 2;
        }
         .urgency-badge.tomorrow { background-color: #ffc107; color: #333; }

        /* --- Carousel Navigation (Arrows & Dots) --- */
        .carousel-nav {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 36px; height: 36px; border-radius: 50%;
            background-color: rgba(17, 14, 14, 0.9);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 10; transition: all 0.3s;
            color: #f5ebeb; opacity: 0.8; border: none;
        }
         .carousel-nav:hover:not(:disabled) {
            background-color: #313131; color: white; opacity: 1;
            transform: translateY(-50%) scale(1.05);
        }
        .carousel-nav:disabled {
            opacity: 0.4; cursor: not-allowed;
            background-color: rgba(230, 230, 230, 0.8); color: #999;
            transform: translateY(-50%);
        }
        .prev-button { left: 5px; }
        .next-button { right: 5px; }

        .carousel-dots {
            display: flex; justify-content: center;
            margin-top: 25px; padding-bottom: 10px;
        }
        .carousel-dot {
            width: 10px; height: 10px; border-radius: 50%;
            background-color: #ccc; margin: 0 5px; cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            border: none; padding: 0;
        }
        .carousel-dot.active { background-color: #7b1fa2; transform: scale(1.2); }

        /* --- Category Colors --- */
        /* Card Header */
        .category-personal { background-color: #ff7043; }
        .category-work { background-color: #42a5f5; }
        .category-meeting { background-color: #66bb6a; }
        .category-holiday { background-color: #ec407a; }
        .category-birthday { background-color: #ab47bc; }
        .category-reminder { background-color: #ffa726; }
        .category-conference { background-color: #26c6da; }
        /* Modal Tag */
        .modal-category-tag.category-personal { background-color: #ff7043; }
        .modal-category-tag.category-work { background-color: #42a5f5; }
        .modal-category-tag.category-meeting { background-color: #66bb6a; }
        .modal-category-tag.category-holiday { background-color: #ec407a; }
        .modal-category-tag.category-birthday { background-color: #ab47bc; }
        .modal-category-tag.category-reminder { background-color: #ffa726; }
        .modal-category-tag.category-conference { background-color: #26c6da; }

        /* --- Share Menu Styles (On Card) --- */
        .share-menu {
            position: absolute;
            bottom: 12px; right: 15px;
            z-index: 5;
        }
        .share-btn {
            width: 30px; height: 30px; border-radius: 50%;
            background-color: rgba(123, 31, 162, 0.15);
            color: #7b1fa2; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;
            border: 1px solid rgba(123, 31, 162, 0.2);
        }
        .share-btn:hover {
             background-color: rgba(123, 31, 162, 0.8); color: white;
             transform: scale(1.1); border-color: transparent;
        }
        .share-options {
            position: absolute; bottom: 40px; right: -5px;
            background-color: white; border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.18);
            padding: 8px; display: flex; gap: 10px;
            opacity: 0; visibility: hidden;
            transform: translateY(10px) scale(0.9);
            transition: opacity 0.25s ease, visibility 0s 0.25s, transform 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 6;
        }
        .share-menu.active .share-options {
            opacity: 1; visibility: visible; transform: translateY(0) scale(1);
            transition-delay: 0s, 0s, 0s;
        }
        .share-option {
            width: 32px; height: 32px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s ease; font-size: 1.1rem;
            border: none; background: none; padding: 0; color: #555;
        }
        .share-option:hover { transform: scale(1.2); color: #000; }
        .share-option.share-copy:hover { color: #6c757d; }
        .share-option.share-whatsapp:hover { color: #25d366; }
        .share-option.share-messenger:hover { color: #0084ff; }


        /* --- Redesigned Event Modal Styles --- */
        .event-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000;
            opacity: 0; visibility: hidden;
            transition: opacity 0.35s ease, visibility 0s 0.35s;
            padding: 20px; box-sizing: border-box;
        }
        .event-modal.active { opacity: 1; visibility: visible; transition-delay: 0s; }

        .modal-content {
            width: 100%; max-width: 600px;
            background-color: white; border-radius: 16px;
            overflow: hidden; position: relative;
            display: flex; flex-direction: column;
            max-height: 90vh;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }
        .event-modal.active .modal-content { transform: scale(1) translateY(0); }

        .modal-close {
            position: absolute; top: 12px; right: 12px;
            width: 32px; height: 32px; background-color: rgba(0, 0, 0, 0.4); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            transition: background-color 0.3s, transform 0.3s; font-size: 1rem;
            border: none; padding: 0; color: white; z-index: 10;
        }
        .modal-close:hover { background-color: rgba(0, 0, 0, 0.6); transform: scale(1.1) rotate(90deg); }

        .modal-image-area {
            width: 100%; height: 220px; overflow: hidden; background-color: #eee;
        }
        .modal-image-area img { display: block; width: 100%; height: 100%; object-fit: cover; object-position: center; }

        .modal-body { padding: 20px 25px 25px 25px; flex-grow: 1; overflow-y: auto; }

        .modal-category-tag {
            display: inline-block; font-size: 0.75rem; font-weight: 600;
            color: #fff; background-color: #888; /* Default, JS overrides */
            padding: 4px 10px; border-radius: 15px; margin-bottom: 12px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        .modal-event-title { font-size: 1.8rem; font-weight: 700; margin: 0 0 15px 0; color: #222; line-height: 1.25; }

        .modal-meta-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px 20px; margin-bottom: 20px; padding-bottom: 15px;
            border-bottom: 1px solid #e5e5e5;
        }
        .meta-item { display: flex; align-items: center; font-size: 0.9rem; color: #555; }
        .meta-icon { flex-shrink: 0; margin-right: 10px; color: #7b1fa2; width: 18px; text-align: center; font-size: 1.1rem; }
        .meta-text { line-height: 1.4; }
        .meta-item-full { grid-column: 1 / -1; }

        .modal-event-desc { margin: 0 0 25px 0; font-size: 1rem; line-height: 1.6; color: #444; }

        .modal-event-actions {
            display: flex; flex-wrap: wrap; gap: 12px; justify-content: flex-end;
            margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e5e5;
        }
        .event-action-btn {
            padding: 10px 20px; border-radius: 8px; font-size: 0.9rem; font-weight: 500;
            cursor: pointer; display: inline-flex; align-items: center; justify-content: center;
            transition: all 0.25s ease; border: none; text-decoration: none;
        }
        .event-action-btn.primary { background-color: #7b1fa2; color: white; }
        .event-action-btn.secondary { background-color: #f0f0f0; color: #444; border: 1px solid #ddd; }
        .event-action-btn.primary:hover { background-color: #4a148c; box-shadow: 0 4px 12px rgba(123, 31, 162, 0.3); transform: translateY(-2px); }
        .event-action-btn.secondary:hover { background-color: #e0e0e0; border-color: #ccc; color: #222; transform: translateY(-2px); }
        .event-action-btn i { margin-right: 8px; font-size: 0.9em; }


        /* --- Responsive Adjustments --- */
        @media (max-width: 1024px) {
            .featured-event-card { flex-basis: 240px; margin: 0 8px; height: 170px;} /* Adjusted height */
        }

        @media (max-width: 768px) {
            #featured-events { padding: 30px 0; }
            #featured-events h2 { font-size: 1.8rem; margin-bottom: 25px; }
            #featured-events .container { padding: 0 10px; }
            .featured-event-card { flex-basis: 220px; margin: 0 6px; height: 165px; } /* Adjusted height */
            .carousel-nav { width: 32px; height: 32px; }
            .prev-button { left: 2px; }
            .next-button { right: 2px; }

            .modal-content { max-width: 95%; max-height: 85vh; }
            .modal-image-area { height: 180px; }
            .modal-body { padding: 15px 20px 20px 20px; }
            .modal-event-title { font-size: 1.5rem; margin-bottom: 12px; }
            .modal-meta-grid { grid-template-columns: 1fr; gap: 10px; }
            .modal-event-desc { font-size: 0.95rem; }
            .modal-event-actions { justify-content: center; }
        }

        @media (max-width: 480px) {
             #featured-events h2 { font-size: 1.6rem; margin-bottom: 20px; }
            .featured-event-card { flex-basis: 190px; margin: 0 5px; height: 170px; border-radius: 10px; } /* Adjusted height */
            .featured-event-title { font-size: 0.9rem; min-height: 2.4em; margin-bottom: 4px;}
            .featured-event-detail { font-size: 0.7rem; margin-bottom: 4px; }
            .featured-event-detail i { font-size: 0.75rem; margin-right: 4px; }
            .event-date-badge { font-size: 0.65rem; padding: 3px 6px; }
            .event-category-tag { font-size: 0.65rem; padding: 2px 5px; }
            .carousel-nav { display: none; }
            .carousel-dots { margin-top: 20px; }
            .carousel-dot { width: 8px; height: 8px; margin: 0 4px; }

            /* Share Menu Responsive */
            .share-menu { bottom: 10px; right: 10px; }
            .share-btn { width: 28px; height: 28px; font-size: 0.8rem; }
            .share-options { bottom: 35px; gap: 8px; padding: 6px; }
            .share-option { width: 28px; height: 28px; font-size: 1rem; }

            /* Modal Responsive */
            .event-modal { padding: 10px; }
            .modal-content { border-radius: 12px; max-height: 80vh; }
            .modal-close { top: 8px; right: 8px; width: 28px; height: 28px; font-size: 0.9rem;}
            .modal-image-area { height: 150px; }
            .modal-body { padding: 15px; }
            .modal-category-tag { font-size: 0.7rem; padding: 3px 8px; margin-bottom: 10px;}
            .modal-event-title { font-size: 1.3rem; }
            .meta-item { font-size: 0.85rem; }
            .meta-icon { font-size: 1rem; margin-right: 8px; }
            .modal-event-desc { font-size: 0.9rem; line-height: 1.5; margin-bottom: 20px; }
            .event-action-btn { width: 100%; justify-content: center; padding: 10px 15px; font-size: 0.9rem;}
            .modal-event-actions { gap: 10px; padding-top: 10px; border-top: none; }
        }

.copy-message {
    font-size: 0.8rem;
    color: green;
    margin-left: 5px;
}

    </style>
</head>
<body>
    <!-- Section HTML -->
    <section id="featured-events" role="region" aria-labelledby="featured-events-title">
        <div class="container">
            <h2 id="featured-events-title">Don't Miss These!</h2>
            <div class="featured-carousel">
                <div class="carousel-track" id="featured-events-track">
                    <!-- Event cards populated by JS -->
                </div>
                <button class="carousel-nav prev-button" aria-label="Previous slide">
                    <i class="fas fa-chevron-left" aria-hidden="true"></i>
                </button>
                 <button class="carousel-nav next-button" aria-label="Next slide">
                    <i class="fas fa-chevron-right" aria-hidden="true"></i>
                </button>
            </div>
            <div class="carousel-dots" id="carousel-dots">
                <!-- Dots populated by JS -->
            </div>
        </div>
    </section>

    <!-- Redesigned Event Detail Modal HTML -->
    <div class="event-modal" id="event-modal" role="dialog" aria-modal="true" aria-labelledby="modal-event-title" hidden>
        <div class="modal-content">
            <button class="modal-close" id="modal-close" aria-label="Close modal">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
            <div class="modal-image-area">
                <img id="modal-event-image" src="" alt="Event Image" />
            </div>
            <div class="modal-body">
                 <span class="modal-category-tag" id="modal-event-category-tag"></span>
                <h3 class="modal-event-title" id="modal-event-title"></h3>
                <div class="modal-meta-grid">
                    <div class="meta-item">
                        <i class="far fa-calendar-alt meta-icon" aria-hidden="true"></i>
                        <span id="modal-event-date" class="meta-text"></span>
                    </div>
                    <div class="meta-item">
                        <i class="far fa-clock meta-icon" aria-hidden="true"></i>
                        <span id="modal-event-time" class="meta-text"></span>
                    </div>
                    <div class="meta-item meta-item-full">
                        <i class="fas fa-map-marker-alt meta-icon" aria-hidden="true"></i>
                        <span id="modal-event-location" class="meta-text"></span>
                    </div>
                </div>
                <p class="modal-event-desc" id="modal-event-desc"></p>
                <div class="modal-event-actions" id="modal-event-actions">
                    <!-- Action buttons populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Sample Data (with imageUrl) ---
            const upcomingEvents = [
                 (() => {
                    const today = new Date(); const tomorrow = new Date(); tomorrow.setDate(today.getDate() + 1); const nextWeek = new Date(); nextWeek.setDate(today.getDate() + 7);
                    const formatDate = (d) => d.toISOString().split('T')[0]; const formatShortDate = (d) => d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const placeholderImg = "https://via.placeholder.com/600x220/cccccc/888888?text=Event";
                    return [
                        { id: 1, title: "Urgent: Project Alpha Deadline", fullDate: formatDate(today), date: "Today", time: "5:00 PM", location: "Online Submission", description: "Final deadline for Project Alpha submission. Ensure all documents are uploaded and verified.", category: "work", categoryName: "Work", imageUrl: "https://via.placeholder.com/600x220/42a5f5/ffffff?text=Work+Deadline", actions: [ { type: "join", label: "View Details", icon: "fa-eye" }, { type: "contact", label: "Support", icon: "fa-headset" }] },
                        { id: 2, title: "Team Sync Meeting", fullDate: formatDate(tomorrow), date: "Tomorrow", time: "10:00 AM - 11:00 AM", location: "Conf Room B / Zoom", description: "Quick sync-up meeting to discuss progress and plan. Come prepared with updates.", category: "meeting", categoryName: "Meeting", imageUrl: "https://via.placeholder.com/600x220/66bb6a/ffffff?text=Meeting", actions: [ { type: "join", label: "Add to Calendar", icon: "fa-calendar-plus" }, { type: "contact", label: "Agenda", icon: "fa-list-alt" }] },
                        { id: 3, title: "Company Social Hour", fullDate: formatDate(nextWeek), date: formatShortDate(nextWeek), time: "4:00 PM - 6:00 PM", location: "Rooftop Terrace", description: "Relax and connect with colleagues. Drinks and snacks provided.", category: "holiday", categoryName: "Social Event", imageUrl: "https://via.placeholder.com/600x220/ec407a/ffffff?text=Social+Event", actions: [ { type: "join", label: "RSVP", icon: "fa-check-circle" }, { type: "contact", label: "More Info", icon: "fa-info-circle" }] },
                        { id: 4, title: "Product Launch Presentation", fullDate: "2024-04-25", date: "Apr 25", time: "11:00 AM", location: "Exhibition Center", description: "Unveiling our new product line. Includes live demos, Q&A, and networking.", category: "work", categoryName: "Work", imageUrl: placeholderImg, actions: [ { type: "tickets", label: "Register", icon: "fa-ticket-alt" }, { type: "contact", label: "Contact Team", icon: "fa-envelope" }] },
                        { id: 5, title: "Sarah Miller's Birthday", fullDate: "2024-04-28", date: "Apr 28", time: "3:00 PM", location: "Break Room", description: "Cake and celebrations for Sarah's birthday! Sign the card at reception.", category: "birthday", categoryName: "Birthday", imageUrl: "https://via.placeholder.com/600x220/ab47bc/ffffff?text=Birthday!", actions: [ { type: "join", label: "Send Wishes", icon: "fa-gift" }, { type: "contact", label: "Contribute", icon: "fa-hand-holding-heart" }] },
                        { id: 6, title: "InnovateTech Conference 2024", fullDate: "2024-05-05", date: "May 5", time: "9:00 AM - 5:00 PM", location: "Convention Center", description: "Annual tech conference with industry leaders, workshops, and networking.", category: "conference", categoryName: "Conference", imageUrl: "https://via.placeholder.com/600x220/26c6da/ffffff?text=Conference", actions: [ { type: "tickets", label: "Buy Tickets", icon: "fa-ticket-alt" }, { type: "join", label: "Add to Calendar", icon: "fa-calendar-plus" }] }
                    ];
                })()
            ].flat();

            // --- Carousel Logic Object ---
            const featuredCarousel = {
                // Core Selectors
                track: document.getElementById('featured-events-track'),
                dotsContainer: document.getElementById('carousel-dots'),
                prevButton: document.querySelector('.prev-button'),
                nextButton: document.querySelector('.next-button'),
                // Modal Selectors
                modal: document.getElementById('event-modal'),
                modalClose: document.getElementById('modal-close'),
                modalImage: document.getElementById('modal-event-image'),
                modalCategoryTag: document.getElementById('modal-event-category-tag'),
                modalEventTitle: document.getElementById('modal-event-title'),
                modalDate: document.getElementById('modal-event-date'),
                modalTime: document.getElementById('modal-event-time'),
                modalLocation: document.getElementById('modal-event-location'),
                modalDesc: document.getElementById('modal-event-desc'),
                modalActions: document.getElementById('modal-event-actions'),
                // State
                currentIndex: 0, totalSlides: upcomingEvents.length, slidesToShow: 4, slideWidth: 0,
                touchStartX: 0, touchEndX: 0, isDragging: false,

                // --- Methods ---
                init: function() {
                    this.populateEvents(); this.handleResize(); this.createDots();
                    this.setupListeners(); this.goToSlide(0, false);
                },
                getUrgency: function(fullDate) { /* ... (same as before) ... */
                     if (!fullDate) return null; try { const today = new Date(); today.setHours(0, 0, 0, 0); const tomorrow = new Date(); tomorrow.setDate(today.getDate() + 1); tomorrow.setHours(0, 0, 0, 0); const [y, m, d] = fullDate.split('-').map(Number); const eventDate = new Date(y, m - 1, d); eventDate.setHours(0, 0, 0, 0); if (eventDate.getTime() === today.getTime()) return { text: "Today", class: "today" }; if (eventDate.getTime() === tomorrow.getTime()) return { text: "Tomorrow", class: "tomorrow" }; } catch (e) { console.error("Date parse error:", fullDate, e); } return null;
                },
                populateEvents: function() {
                    this.track.innerHTML = '';
                    upcomingEvents.forEach((event) => {
                        const eventCard = document.createElement('div'); eventCard.className = 'featured-event-card'; eventCard.dataset.id = event.id; eventCard.setAttribute('role', 'group'); eventCard.setAttribute('aria-label', event.title);
                        const urgency = this.getUrgency(event.fullDate); const urgencyBadgeHTML = urgency ? `<div class="urgency-badge ${urgency.class}">${urgency.text}</div>` : '';
                        eventCard.innerHTML = `
                            ${urgencyBadgeHTML}
                            <div class="event-card-header category-${event.category}"></div>
                            <div class="event-card-content">
                                <div class="event-meta-top">
                                     <div class="event-date-badge"><i class="far fa-calendar-alt" aria-hidden="true"></i>${event.date}</div>
                                    <span class="event-category-tag">${event.categoryName || event.category}</span>
                                </div>
                                <h3 class="featured-event-title">${event.title}</h3>
                                <div class="featured-event-detail featured-event-time"><i class="far fa-clock" aria-hidden="true"></i><span>${event.time}</span></div>
                                <div class="featured-event-detail featured-event-location"><i class="fas fa-map-marker-alt" aria-hidden="true"></i><span>${event.location}</span></div>
                                <div class="share-menu" data-id="${event.id}">
                                    <button class="share-btn" aria-label="Share this event" aria-haspopup="true" aria-expanded="false"><i class="fas fa-share-alt" aria-hidden="true"></i></button>
                                    <div class="share-options" role="menu">
    <button class="share-option share-copy" data-platform="copy" aria-label="Copy link" role="menuitem">
        <i class="fas fa-link" aria-hidden="true"></i>
        <span class="copy-message" style="display: none;">Link Copied!</span>
    </button>
    <button class="share-option share-whatsapp" data-platform="whatsapp" aria-label="Share on WhatsApp" role="menuitem">
        <i class="fab fa-whatsapp" aria-hidden="true"></i>
    </button>
    <button class="share-option share-messenger" data-platform="messenger" aria-label="Share on Messenger" role="menuitem">
        <i class="fab fa-facebook-messenger" aria-hidden="true"></i>
    </button>
</div>

                                </div>
                            </div>`;
                        this.track.appendChild(eventCard);
                        eventCard.addEventListener('click', (e) => { if (!e.target.closest('.share-menu')) this.openEventModal(event.id); });
                    });
                    this.totalSlides = upcomingEvents.length;
                    this.setupShareMenus(); // Setup share listeners
                },
                handleResize: function() { /* ... (same as before) ... */
                    const windowWidth = window.innerWidth; let newSlidesToShow = 4; if (windowWidth < 480) newSlidesToShow = 1; else if (windowWidth < 768) newSlidesToShow = 2; else if (windowWidth < 1024) newSlidesToShow = 3; if (this.slidesToShow !== newSlidesToShow || this.slideWidth === 0) { this.slidesToShow = newSlidesToShow; requestAnimationFrame(() => { if (this.track.children.length > 0) { const firstCard = this.track.children[0]; const cardStyle = window.getComputedStyle(firstCard); const cardWidth = firstCard.offsetWidth; const marginLeft = parseFloat(cardStyle.marginLeft); const marginRight = parseFloat(cardStyle.marginRight); this.slideWidth = cardWidth + marginLeft + marginRight; this.createDots(); this.currentIndex = Math.min(this.currentIndex, Math.max(0, this.totalSlides - this.slidesToShow)); this.goToSlide(this.currentIndex, false); } else { this.slideWidth = 0; this.createDots(); this.goToSlide(0, false); } }); }
                },
                createDots: function() { /* ... (same as before) ... */
                    this.dotsContainer.innerHTML = ''; const numDots = Math.max(0, this.totalSlides - this.slidesToShow + 1); if (numDots > 1) { for (let i = 0; i < numDots; i++) { const dot = document.createElement('button'); dot.className = 'carousel-dot'; dot.dataset.index = i; dot.setAttribute('aria-label', `Go to slide group ${i + 1}`); dot.addEventListener('click', () => this.goToSlide(i)); this.dotsContainer.appendChild(dot); } } this.updateActiveDot();
                },
                updateActiveDot: function() { /* ... (same as before) ... */
                     Array.from(this.dotsContainer.children).forEach((dot, i) => { if (i === this.currentIndex) { dot.classList.add('active'); dot.setAttribute('aria-current', 'true'); } else { dot.classList.remove('active'); dot.removeAttribute('aria-current'); } });
                },
                setupListeners: function() { /* ... (same as before - includes modal, touch, resize) ... */
                    this.prevButton.addEventListener('click', () => this.goToSlide(this.currentIndex - 1)); this.nextButton.addEventListener('click', () => this.goToSlide(this.currentIndex + 1)); this.track.addEventListener('touchstart', (e) => { this.touchStartX = e.touches[0].clientX; this.isDragging = true; this.track.style.transition = 'none'; }, { passive: true }); this.track.addEventListener('touchmove', (e) => { if (!this.isDragging) return; this.touchEndX = e.touches[0].clientX; }, { passive: true }); this.track.addEventListener('touchend', () => { if (!this.isDragging) return; this.isDragging = false; this.track.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)'; if (this.touchEndX === 0) this.touchEndX = this.touchStartX; this.handleSwipe(); this.touchEndX = 0; }); this.track.addEventListener('touchcancel', () => { if (!this.isDragging) return; this.isDragging = false; this.track.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)'; this.goToSlide(this.currentIndex, true); this.touchEndX = 0; }); this.modalClose.addEventListener('click', () => this.closeEventModal()); this.modal.addEventListener('click', (e) => { if (e.target === this.modal) this.closeEventModal(); }); document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && this.modal.classList.contains('active')) this.closeEventModal(); }); let resizeTimer; window.addEventListener('resize', () => { clearTimeout(resizeTimer); resizeTimer = setTimeout(() => this.handleResize(), 250); });
                },
                handleSwipe: function() { /* ... (same as before) ... */
                    const swipeThreshold = 50; const diff = this.touchStartX - this.touchEndX; if (Math.abs(diff) > swipeThreshold) { if (diff > 0) this.goToSlide(this.currentIndex + 1); else this.goToSlide(this.currentIndex - 1); } else { this.goToSlide(this.currentIndex, true); }
                },
                goToSlide: function(index, animate = true) { /* ... (same as before) ... */
                     if ((!this.slideWidth || this.slideWidth <= 0) && this.track.children.length > 0) { this.handleResize(); return; } if (!this.slideWidth || this.slideWidth <= 0) return; const maxIndex = Math.max(0, this.totalSlides - this.slidesToShow); index = Math.max(0, Math.min(index, maxIndex)); this.currentIndex = index; const position = -this.currentIndex * this.slideWidth; this.track.style.transition = animate ? 'transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)' : 'none'; this.track.style.transform = `translateX(${position}px)`; if (!animate) { requestAnimationFrame(() => { requestAnimationFrame(() => { this.track.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)'; }); }); } this.updateActiveDot(); this.updateNavButtons(maxIndex);
                },
                updateNavButtons: function(maxIndex) { /* ... (same as before) ... */
                     this.prevButton.disabled = (this.currentIndex === 0); this.nextButton.disabled = (this.currentIndex >= maxIndex);
                },

                // --- Share Methods ---
                setupShareMenus: function() { /* ... (same as before) ... */
                    const shareMenus = this.track.querySelectorAll('.share-menu'); shareMenus.forEach(menu => { const shareBtn = menu.querySelector('.share-btn'); const shareOptionsContainer = menu.querySelector('.share-options'); const eventId = parseInt(menu.dataset.id); const event = upcomingEvents.find(e => e.id === eventId); if (!event) return; shareBtn.addEventListener('click', (e) => { e.stopPropagation(); const isActive = menu.classList.contains('active'); this.track.querySelectorAll('.share-menu.active').forEach(activeMenu => { if (activeMenu !== menu) { activeMenu.classList.remove('active'); activeMenu.querySelector('.share-btn').setAttribute('aria-expanded', 'false'); } }); menu.classList.toggle('active'); shareBtn.setAttribute('aria-expanded', !isActive); }); const shareOptions = shareOptionsContainer.querySelectorAll('.share-option'); shareOptions.forEach(option => { option.addEventListener('click', (e) => { e.stopPropagation(); const platform = option.dataset.platform; this.shareEvent(event, platform, option); menu.classList.remove('active'); shareBtn.setAttribute('aria-expanded', 'false'); }); }); }); document.addEventListener('click', (e) => { if (!e.target.closest('.share-menu')) { this.track.querySelectorAll('.share-menu.active').forEach(activeMenu => { activeMenu.classList.remove('active'); activeMenu.querySelector('.share-btn').setAttribute('aria-expanded', 'false'); }); } }, true);
                },
                shareEvent: async function(event, platform, buttonElement) { /* ... (same as before - remember FB App ID placeholder) ... */
                    const eventUrl = window.location.href; const eventTitle = event.title; const eventText = `${event.title} on ${event.date} at ${event.time}. Location: ${event.location}`; const encodedUrl = encodeURIComponent(eventUrl); const encodedText = encodeURIComponent(eventText); const encodedTitle = encodeURIComponent(eventTitle); let shareUrl = ''; switch (platform) { case 'copy': try { await navigator.clipboard.writeText(eventUrl); const originalIcon = buttonElement.innerHTML; buttonElement.innerHTML = '<i class="fas fa-check" style="color: green;"></i>'; setTimeout(() => { buttonElement.innerHTML = originalIcon; }, 1500); } catch (err) { console.error('Failed to copy link: ', err); alert('Failed to copy link.'); } return; case 'whatsapp': shareUrl = `https://wa.me/?text=${encodedText}%0A${encodedUrl}`; break; case 'messenger': shareUrl = `https://www.facebook.com/dialog/send?link=${encodedUrl}&app_id=123456789&redirect_uri=${encodedUrl}`; console.warn("Messenger share requires valid FB App ID."); break; default: console.warn('Unknown share platform:', platform); return; } if (shareUrl) { window.open(shareUrl, '_blank', 'noopener,noreferrer,width=600,height=400'); }
                },

                // --- Modal Methods ---
                openEventModal: function(eventId) { /* ... (same as before - populates new modal structure) ... */
                    const eventData = upcomingEvents.find(e => e.id === eventId); if (!eventData) return; this.modalImage.src = eventData.imageUrl || "https://via.placeholder.com/600x220/cccccc/888888?text=Event"; this.modalImage.alt = eventData.title + " event image"; this.modalCategoryTag.textContent = eventData.categoryName || eventData.category; this.modalCategoryTag.className = `modal-category-tag category-${eventData.category}`; this.modalEventTitle.textContent = eventData.title; this.modalEventTitle.setAttribute('id', `modal-event-title-${eventData.id}`); this.modal.setAttribute('aria-labelledby', `modal-event-title-${eventData.id}`); this.modalDate.textContent = eventData.fullDate ? new Date(eventData.fullDate).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'}) : eventData.date; this.modalTime.textContent = eventData.time; this.modalLocation.textContent = eventData.location; this.modalDesc.textContent = eventData.description; this.modalActions.innerHTML = ''; if (eventData.actions && Array.isArray(eventData.actions)) { eventData.actions.forEach(action => { const button = document.createElement('button'); const isPrimary = ['join', 'tickets', 'rsvp', 'register'].includes(action.type); button.className = `event-action-btn ${isPrimary ? 'primary' : 'secondary'}`; button.innerHTML = `<i class="fas ${action.icon}" aria-hidden="true"></i> ${action.label}`; button.addEventListener('click', () => { alert(`Action: '${action.label}' for event '${eventData.title}'\n(Actual implementation needed)`); }); this.modalActions.appendChild(button); }); } this.modal.removeAttribute('hidden'); requestAnimationFrame(() => { this.modal.classList.add('active'); }); document.body.style.overflow = 'hidden'; this.modal.querySelector('.modal-close').focus();
                },
                closeEventModal: function() { /* ... (same as before) ... */
                    this.modal.classList.remove('active'); this.modal.addEventListener('transitionend', () => { this.modal.setAttribute('hidden', 'true'); }, { once: true }); document.body.style.overflow = '';
                }
                

            }; // End featuredCarousel Object

            // --- Initialize ---
            featuredCarousel.init();

        }); // End DOMContentLoaded
    </script>
</body>
</html>